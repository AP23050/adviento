<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendario de Adviento ğŸ„</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#ffd6e8,#e6ddff);
  text-align:center;
}
h1{color:#c2185b;margin:20px}
button{
  background:#c2185b;
  color:#fff;
  border:none;
  padding:12px 24px;
  border-radius:20px;
  margin:8px;
  font-size:15px;
}
.calendar{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
  padding:20px;
  max-width:520px;
  margin:auto;
}
.day{
  background:#fff;
  padding:18px;
  border-radius:15px;
  font-size:18px;
}
.day.opened{background:#ffb3d9}
.day.locked{opacity:.4}

a.day-link{
  display:block;
  color:#c2185b;
  font-weight:600;
  text-decoration:none;
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  justify-content:center;
  align-items:center;
}
.modal-content{
  background:#fff;
  padding:20px;
  border-radius:15px;
  width:340px;
}
img{
  max-width:100%;
  border-radius:12px;
}
#gallery{
  display:none;
  padding:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:10px;
}
</style>
</head>

<body>

<h1>ğŸ Calendario de Adviento para Macy</h1>

<button onclick="showCalendar()">ğŸ“… Calendario</button>
<button onclick="showGallery()">ğŸ“¸ ColecciÃ³n</button>
<button onclick="generatePDF()">ğŸ“„ PDF</button>

<div class="calendar" id="calendar"></div>

<div id="gallery">
  <h2>ğŸ’– ColecciÃ³n de recuerdos</h2>
  <div class="grid" id="galleryGrid"></div>
  <button onclick="showCalendar()">â† Volver</button>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <img id="modalImg" style="display:none">
    <input type="file" id="photo24" accept="image/*" style="display:none">
    <br><br>
    <button onclick="closeModal()">Cerrar</button>
  </div>
</div>

<script>
const gifts=[
"Sandalias","$10","UÃ±as manos","UÃ±as pies","Salutaris","Calcetines",
"Takis fuego","Toallas hÃºmedas","Pringles queso","Starbucks",
"Tosh y bombÃ³n","Flores","Almendras","Limas","Chamoy","Gomitas",
"Vela aromÃ¡tica","Taza Friends","Perfume Givenchy","Revlon",
"Gancho","Labial Givenchy","Desmaquillador","Sorpresa final ğŸ’–"
];

let opened=JSON.parse(localStorage.getItem("openedDays")||"[]");
let images=JSON.parse(localStorage.getItem("images")||"{}");

const calendar=document.getElementById("calendar");

function render(){
  calendar.innerHTML="";
  for(let d=1; d<=24; d++){
    const div=document.createElement("div");
    div.className="day";
    if(opened.includes(d)) div.classList.add("opened");

    const a=document.createElement("a");
    a.href="#";
    a.className="day-link";
    a.textContent=d;
    a.onclick=(e)=>{e.preventDefault();openDay(d)};

    div.appendChild(a);
    calendar.appendChild(div);
  }
}
render();

function openDay(d){
  if(d===24){
    const pass=prompt("Clave especial");
    if(pass!=="MR101025") return;
  }

  if(!opened.includes(d)){
    opened.push(d);
    localStorage.setItem("openedDays",JSON.stringify(opened));
  }

  document.getElementById("modalTitle").textContent=`DÃ­a ${d} â€“ ${gifts[d-1]}`;

  const img=document.getElementById("modalImg");
  const input=document.getElementById("photo24");
  img.style.display="none";
  input.style.display="none";

  if(d===24){
    input.style.display="block";
    input.onchange=()=>{
      const file=input.files[0];
      const reader=new FileReader();
      reader.onload=()=>{
        images[d]=reader.result;
        localStorage.setItem("images",JSON.stringify(images));
        img.src=reader.result;
        img.style.display="block";
      };
      reader.readAsDataURL(file);
    };
  }else if(images[d]){
    img.src=images[d];
    img.style.display="block";
  }

  document.getElementById("modal").style.display="flex";
  render();
}

function closeModal(){
  document.getElementById("modal").style.display="none";
}

function showGallery(){
  document.getElementById("calendar").style.display="none";
  document.getElementById("gallery").style.display="block";

  const grid=document.getElementById("galleryGrid");
  grid.innerHTML="";
  opened.forEach(d=>{
    if(images[d]){
      grid.innerHTML+=`
      <div class="card">
        <img src="${images[d]}">
        <p>DÃ­a ${d} â€“ ${gifts[d-1]}</p>
      </div>`;
    }
  });
}

function showCalendar(){
  document.getElementById("gallery").style.display="none";
  document.getElementById("calendar").style.display="grid";
}

/* ===== PDF ===== */
function generatePDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();

  pdf.setFontSize(22);
  pdf.text("Calendario de Adviento",105,30,null,null,"center");

  let x=15,y=45,c=0;
  opened.forEach(d=>{
    if(images[d]){
      pdf.addImage(images[d],"PNG",x,y,50,50);
      pdf.text(`DÃ­a ${d} â€“ ${gifts[d-1]}`,x,y+55);
      x+=60;c++;
      if(c%3===0){x=15;y+=70;}
      if(y>250){pdf.addPage();x=15;y=20;}
    }
  });

  pdf.save("Calendario_Macy.pdf");
}
</script>

</body>
</html>