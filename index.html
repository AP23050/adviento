<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendario de Adviento üéÑ</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:'Arial',sans-serif;
  background:linear-gradient(135deg,#ffd6e8,#e6ddff);
  text-align:center;
}
h1{color:#c2185b;margin:20px}
button{
  background:#c2185b;
  color:#fff;
  border:none;
  padding:12px 24px;
  border-radius:20px;
  margin:8px;
  font-size:15px;
  cursor:pointer;
}
.calendar{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
  padding:20px;
  max-width:520px;
  margin:auto;
}
.day{
  background:#fff;
  padding:18px;
  border-radius:15px;
  font-size:18px;
}
.day.opened{background:#ffb3d9}
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  justify-content:center;
  align-items:center;
}
.modal-content{
  background:#fff;
  padding:20px;
  border-radius:15px;
  width:340px;
}
img{
  max-width:100%;
  border-radius:12px;
}
</style>
</head>

<body>

<h1>üéÅ Calendario de Adviento para Macy</h1>

<button onclick="goGallery()">üì∏ Colecci√≥n</button>
<button onclick="generatePDF()">üìÑ Descargar PDF</button>

<div class="calendar" id="calendar"></div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <img id="modalImg" style="display:none">
    <input type="file" id="photo24" accept="image/*" style="display:none">
    <br>
    <button onclick="closeModal()">Cerrar</button>
  </div>
</div>

<script>
const gifts=[
"Sandalias","$10","U√±as manos","U√±as pies","Salutaris","Calcetines",
"Takis fuego","Toallas h√∫medas","Pringles queso","Starbucks",
"Tosh y bomb√≥n","Flores","Almendras","Limas","Chamoy","Gomitas",
"Vela arom√°tica","Taza Friends","Perfume Givenchy","Revlon",
"Gancho","Labial Givenchy","Desmaquillador","Sorpresa final üíñ"
];

let opened=JSON.parse(localStorage.getItem("openedDays")||"[]");
let images=JSON.parse(localStorage.getItem("images")||"{}");

const calendar=document.getElementById("calendar");

function render(){
  calendar.innerHTML="";
  for(let d=1; d<=24; d++){
    const div=document.createElement("div");
    div.className="day";
    div.textContent=d;
    if(opened.includes(d)) div.classList.add("opened");
    div.onclick=()=>openDay(d);
    calendar.appendChild(div);
  }
}
render();

function openDay(d){
  if(d===24){
    const pass=prompt("Clave especial");
    if(pass!=="MR101025") return alert("Clave incorrecta");
  }
  if(!opened.includes(d)){
    opened.push(d);
    localStorage.setItem("openedDays",JSON.stringify(opened));
  }
  document.getElementById("modalTitle").textContent=`D√≠a ${d} ‚Äì ${gifts[d-1]}`;

  const img=document.getElementById("modalImg");
  const input=document.getElementById("photo24");
  img.style.display="none";
  input.style.display="none";

  if(d===24){
    input.style.display="block";
    input.onchange=()=>{
      const file=input.files[0];
      const reader=new FileReader();
      reader.onload=()=>{
        images[d]=reader.result;
        localStorage.setItem("images",JSON.stringify(images));
        img.src=reader.result;
        img.style.display="block";
      };
      reader.readAsDataURL(file);
    };
  }else if(images[d]){
    img.src=images[d];
    img.style.display="block";
  }

  document.getElementById("modal").style.display="flex";
  render();
}

function closeModal(){
  document.getElementById("modal").style.display="none";
}

/* ===== GALER√çA ===== */
function goGallery(){
  let html="";
  opened.forEach(d=>{
    if(images[d]){
      html+=`<p>D√≠a ${d} ‚Äì ${gifts[d-1]}</p><img src="${images[d]}">`;
    }
  });
  const w=window.open();
  w.document.write(`<body style="font-family:Arial">${html}</body>`);
}

/* ===== PDF PROFESIONAL ===== */
function generatePDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("p","mm","a4");

  pdf.setFillColor(255,230,240);
  pdf.rect(0,0,210,297,"F");
  pdf.setFontSize(24);
  pdf.text("üéÑ Calendario de Adviento üéÑ",105,40,null,null,"center");
  pdf.setFontSize(16);
  pdf.text("Para Macy, con amor üíñ",105,55,null,null,"center");

  let x=15,y=70,c=0;
  opened.forEach(d=>{
    if(images[d]){
      pdf.addImage(images[d],"JPEG",x,y,50,50);
      pdf.text(`D√≠a ${d}`,x,y+55);
      c++;
      x+=60;
      if(c%3===0){x=15;y+=70;}
      if(y>250){pdf.addPage();x=15;y=20;}
    }
  });

  pdf.save("Calendario_Adviento_Macy.pdf");
}
</script>

</body>
</html>